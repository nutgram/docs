"use strict";(self.webpackChunknutgram_docs=self.webpackChunknutgram_docs||[]).push([[1778],{60096:function(e,t,n){n.r(t),n.d(t,{assets:function(){return d},contentTitle:function(){return r},default:function(){return m},frontMatter:function(){return o},metadata:function(){return l},toc:function(){return u}});var a=n(83117),i=(n(67294),n(3905)),s=n(56022);const o={sidebar_position:2},r="Sending Requests",l={unversionedId:"usage/sending_requests",id:"usage/sending_requests",title:"Sending Requests",description:"The framework creates a 1:1 mapping of the methods Telegram provides that are directly accessible from the main",source:"@site/docs/usage/sending_requests.md",sourceDirName:"usage",slug:"/usage/sending_requests",permalink:"/docs/usage/sending_requests",draft:!1,editUrl:"https://github.com/nutgram/docs/tree/master/docs/usage/sending_requests.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"docs",previous:{title:"Getting Updates",permalink:"/docs/usage/getting_updates"},next:{title:"Handlers",permalink:"/docs/usage/handlers"}},d={},u=[{value:"Uploading media",id:"uploading-media",level:2},{value:"Via URL",id:"via-url",level:3},{value:"Via InputFile (file path)",id:"via-inputfile-file-path",level:3},{value:"Via InputFile (file resource)",id:"via-inputfile-file-resource",level:3},{value:"Via <code>file_id</code>",id:"via-file_id",level:3},{value:"Get upload progress",id:"get-upload-progress",level:3},{value:"Downloading media",id:"downloading-media",level:2},{value:"Via <code>downloadFile</code> method",id:"via-downloadfile-method",level:3},{value:"Via <code>save</code> method",id:"via-save-method",level:3},{value:"Get download progress",id:"get-download-progress",level:3},{value:"Formatting options",id:"formatting-options",level:2},{value:"Available methods",id:"available-methods",level:2},{value:"Chunked methods",id:"chunked-methods",level:2},{value:"Reply directly to incoming updates",id:"reply-directly-to-incoming-updates",level:2},{value:"Warnings",id:"warnings",level:3},{value:"Flow",id:"flow",level:3},{value:"Usage",id:"usage",level:3}],g={toc:u};function m(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,a.Z)({},g,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"sending-requests"},"Sending Requests"),(0,i.kt)("p",null,"The framework creates a 1:1 mapping of the methods Telegram provides that are directly accessible from the main\ninstance. The parameters of these methods are organized to prioritize mandatory parameters, followed by optional ones.\nIf the ",(0,i.kt)("inlineCode",{parentName:"p"},"$clientOpt")," parameter is included, it will consistently be positioned at the end.\nWe recommend the use of named parameters, which allow the developer to explicitly specify the values for each parameter,\nmaking the code easier to read and maintain."),(0,i.kt)("p",null,"For example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php"},"\nuse SergiX44\\Nutgram\\Nutgram;\nuse SergiX44\\Nutgram\\Telegram\\Types\\Message\\Message;\n\n$bot = new Nutgram($_ENV['TOKEN']);\n\n// Send a message to a specific user\n$message = $bot->sendMessage(\n    text: 'Hi!',\n    chat_id: 123456789\n);\n\n// Send a message to a channel\n$message = $bot->sendMessage(\n    text: 'Hi channel!',\n    chat_id: '@mychannel'\n);\n")),(0,i.kt)("h2",{id:"uploading-media"},"Uploading media"),(0,i.kt)("p",null,"For any method that require an ",(0,i.kt)("a",{parentName:"p",href:"https://core.telegram.org/bots/api#inputfile"},(0,i.kt)("inlineCode",{parentName:"a"},"InputFile")),", you can pass a resource file\ndescriptor to the right method, and the framework will take care of how uploading it, like in the following example."),(0,i.kt)("h3",{id:"via-url"},"Via URL"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php"},"use SergiX44\\Nutgram\\Nutgram;\nuse SergiX44\\Nutgram\\Telegram\\Types\\Internal\\InputFile;\nuse SergiX44\\Nutgram\\Telegram\\Types\\Message\\Message;\n\n$bot = new Nutgram($_ENV['TOKEN']);\n\n$message = $bot->sendPhoto(\n    photo: 'https://example.com/image.png',\n    chat_id: 123456789\n);\n")),(0,i.kt)("h3",{id:"via-inputfile-file-path"},"Via InputFile (file path)"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php"},"use SergiX44\\Nutgram\\Nutgram;\nuse SergiX44\\Nutgram\\Telegram\\Types\\Internal\\InputFile;\nuse SergiX44\\Nutgram\\Telegram\\Types\\Message\\Message;\n\n$bot = new Nutgram($_ENV['TOKEN']);\n\n$message = $bot->sendPhoto(\n    photo: InputFile::make('image.png'),\n    chat_id: 123456789\n);\n")),(0,i.kt)("h3",{id:"via-inputfile-file-resource"},"Via InputFile (file resource)"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php"},"use SergiX44\\Nutgram\\Nutgram;\nuse SergiX44\\Nutgram\\Telegram\\Types\\Internal\\InputFile;\nuse SergiX44\\Nutgram\\Telegram\\Types\\Message\\Message;\n\n$bot = new Nutgram($_ENV['TOKEN']);\n\n$message = $bot->sendVideo(\n    video: InputFile::make(fopen('funnyvideo.mp4', 'r+')),\n    chat_id: 123456789\n);\n")),(0,i.kt)("h3",{id:"via-file_id"},"Via ",(0,i.kt)("inlineCode",{parentName:"h3"},"file_id")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php"},"use SergiX44\\Nutgram\\Nutgram;\nuse SergiX44\\Nutgram\\Telegram\\Types\\Internal\\InputFile;\nuse SergiX44\\Nutgram\\Telegram\\Types\\Message\\Message;\n\n$bot = new Nutgram($_ENV['TOKEN']);\n\n$message = $bot->sendSticker(\n    sticker: $bot->message()->sticker->file_id,\n    chat_id: 123456789\n);\n")),(0,i.kt)("h3",{id:"get-upload-progress"},"Get upload progress"),(0,i.kt)("p",null,"You can get the upload progress of the file by calling the ",(0,i.kt)("inlineCode",{parentName:"p"},"withProgress")," method before your upload method."),(0,i.kt)("admonition",{type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"The callback will be called every time ",(0,i.kt)("strong",{parentName:"p"},"a byte")," is uploaded, so if you are printing the progress via Telegram,\nyou should find a way to avoid spamming the user and ",(0,i.kt)("strong",{parentName:"p"},"hitting the API limits"),".")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php"},"use SergiX44\\Nutgram\\Nutgram;\nuse SergiX44\\Nutgram\\Telegram\\Types\\Internal\\InputFile;\nuse SergiX44\\Nutgram\\Telegram\\Types\\Message\\Message;\n\n$bot = new Nutgram($_ENV['TOKEN']);\n\n$message = $bot\n    ->withProgress(function (Progress $progress) {\n        echo sprintf(\"Uploading video: %s%% - Uploded: %s bytes of %s bytes\\n\",\n            $progress->uploadPercentage(),\n            $progress->uploadedBytes,\n            $progress->totalUploadBytes,\n        );\n    })\n    ->sendVideo(\n        video: InputFile::make('video.mp4'),\n        chat_id: 123456789\n    );\n")),(0,i.kt)("h2",{id:"downloading-media"},"Downloading media"),(0,i.kt)("p",null,"As opposed to uploading, there are some additional methods available that allow you to download files:"),(0,i.kt)("h3",{id:"via-downloadfile-method"},"Via ",(0,i.kt)("inlineCode",{parentName:"h3"},"downloadFile")," method"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php"},"use SergiX44\\Nutgram\\Nutgram;\nuse SergiX44\\Nutgram\\Telegram\\Types\\Media\\File;\n\n$bot = new Nutgram($_ENV['TOKEN']);\n\n$bot->onSticker(function (Nutgram $bot) {\n    // get the file_id\n    $fileId = $bot->message()->sticker->file_id;\n    \n    // get the File\n    $file = $bot->getFile($fileId);\n    \n    // download the file\n    $bot->downloadFile($file, 'file.ext');\n});\n")),(0,i.kt)("h3",{id:"via-save-method"},"Via ",(0,i.kt)("inlineCode",{parentName:"h3"},"save")," method"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php"},"use SergiX44\\Nutgram\\Nutgram;\nuse SergiX44\\Nutgram\\Telegram\\Types\\Media\\File;\n\n$bot = new Nutgram($_ENV['TOKEN']);\n\n$bot->onSticker(function (Nutgram $bot) {\n    // get the file_id\n    $fileId = $bot->message()->sticker->file_id;\n    \n    // get the File and download it\n    $bot->getFile($fileId)->save('file.ext');\n});\n")),(0,i.kt)("h3",{id:"get-download-progress"},"Get download progress"),(0,i.kt)("p",null,"You can get the download progress of the file by calling the ",(0,i.kt)("inlineCode",{parentName:"p"},"withProgress")," method before your download method."),(0,i.kt)("admonition",{type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"The callback will be called every time ",(0,i.kt)("strong",{parentName:"p"},"a byte")," is downloaded, so if you are printing the progress via Telegram,\nyou should find a way to avoid spamming the user and ",(0,i.kt)("strong",{parentName:"p"},"hitting the API limits"),".")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php"},"use SergiX44\\Nutgram\\Nutgram;\nuse SergiX44\\Nutgram\\Telegram\\Types\\Media\\File;\n\n$bot = new Nutgram($_ENV['TOKEN']);\n\n$bot->onSticker(function (Nutgram $bot) {\n    // get the file_id\n    $fileId = $bot->message()->sticker->file_id;\n    \n    // get the File\n    $file = $bot->getFile($fileId);\n    \n    // download the file\n    $bot\n      ->withProgress(function (Progress $progress) {\n          echo sprintf(\"Downloading file: %s%% - Downloaded: %s bytes of %s bytes\\n\",\n              $progress->downloadPercentage(),\n              $progress->downloadedBytes,\n              $progress->totalDownloadBytes,\n          );\n      })\n      ->downloadFile($file, 'file.ext');\n});\n")),(0,i.kt)("h2",{id:"formatting-options"},"Formatting options"),(0,i.kt)("p",null,"To format your text messages, you can use the ",(0,i.kt)("inlineCode",{parentName:"p"},"parse_mode")," parameter.\nJust pass the valid string provided by the Telegram API to the method."),(0,i.kt)("p",null,"Nutgram provides the ParseMode enum to help you with this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php"},"use SergiX44\\Nutgram\\Nutgram;\nuse SergiX44\\Nutgram\\Telegram\\Properties\\ParseMode;\nuse SergiX44\\Nutgram\\Telegram\\Types\\Message\\Message;\n\n$bot = new Nutgram($_ENV['TOKEN']);\n\n// Send a message formatting in markdown\n$message = $bot->sendMessage(\n    text: '*Hi!*',\n    chat_id: 123456789,\n    parse_mode: ParseMode::MARKDOWN,\n);\n\n// Send a message formatting in html\n$message = $bot->sendMessage(\n    text: '<i>Hi!</i>',\n    chat_id: 123456789,\n    parse_mode: ParseMode::HTML,\n);\n")),(0,i.kt)("h2",{id:"available-methods"},"Available methods"),(0,i.kt)("p",null,"See the ",(0,i.kt)("a",{parentName:"p",href:"https://core.telegram.org/bots/api#available-methods"},"Telegram Bot API")," for the available native methods."),(0,i.kt)("h2",{id:"chunked-methods"},"Chunked methods"),(0,i.kt)("p",null,"Nutgram helps manage character limits by splitting messages into smaller ones,\nmaking it easier to stay within the limits set by platforms or media.\nChunking methods allow users to transmit longer messages without exceeding the maximum character limits."),(0,i.kt)("p",null,"Available chunked methods:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"sendChunkedMessage"),(0,i.kt)("li",{parentName:"ul"},"sendChunkedPhoto"),(0,i.kt)("li",{parentName:"ul"},"sendChunkedAudio"),(0,i.kt)("li",{parentName:"ul"},"sendChunkedDocument"),(0,i.kt)("li",{parentName:"ul"},"sendChunkedVideo"),(0,i.kt)("li",{parentName:"ul"},"sendChunkedAnimation"),(0,i.kt)("li",{parentName:"ul"},"sendChunkedVoice")),(0,i.kt)("h2",{id:"reply-directly-to-incoming-updates"},"Reply directly to incoming updates"),(0,i.kt)("p",null,"Nutgram allows you to reply directly to incoming updates, without sending a new request to the Telegram API.\nThis feature will use the second method of\n",(0,i.kt)("a",{parentName:"p",href:"https://core.telegram.org/bots/faq#how-can-i-make-requests-in-response-to-updates"},"replying to a request"),",\nwhich is to reply directly and give the method as JSON payload in the reply."),(0,i.kt)("h3",{id:"warnings"},"Warnings"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"You'll need ",(0,i.kt)("strong",{parentName:"li"},"PHP-FPM")," to use this feature."),(0,i.kt)("li",{parentName:"ul"},"This feature, if enabled, will be automatically used only ",(0,i.kt)("strong",{parentName:"li"},"once per update"),". "),(0,i.kt)("li",{parentName:"ul"},"You'll get ",(0,i.kt)("inlineCode",{parentName:"li"},"null")," if you try to use the return type on a method that has been used with this feature. "),(0,i.kt)("li",{parentName:"ul"},"You'll ",(0,i.kt)("strong",{parentName:"li"},"not get an exception")," if you try to enable this feature on a method that has already been used with this feature\nbecause the method may be called multiple times in the same update depending on the events that are triggered. "),(0,i.kt)("li",{parentName:"ul"},"This feature will be ",(0,i.kt)("strong",{parentName:"li"},"not used")," in multipart requests.")),(0,i.kt)("h3",{id:"flow"},"Flow"),(0,i.kt)(s.G,{chart:'flowchart LR\n\n  F{"asResponse()\\nenabled?"}\n  RD[Send another request]\n  E{PHP-FPM\\nenv?}\n  RF[Reply directly]\n  RS{Direct response\\nalready sent?}\n\n  F --\x3e |No| RD\n  F --\x3e |Yes| RS\n  RS --\x3e |Yes| RD\n  RS --\x3e |No| E\n  E --\x3e |No| RD\n  E --\x3e |Yes| RF',mdxType:"Mermaid"}),(0,i.kt)("h3",{id:"usage"},"Usage"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php"},"$bot = new Nutgram('token');\n\n$bot->onCommand('start', function(Nutgram $bot){\n    $bot->asResponse()->sendMessage('hello'); // This will reply directly and give the method as JSON payload in the reply\n    \n    $bot->sendMessage('world'); // This will reply sending a request to the Telegram API\n});\n\n$bot->run();\n")))}m.isMDXComponent=!0}}]);